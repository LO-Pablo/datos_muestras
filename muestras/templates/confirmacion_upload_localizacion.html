{% extends "master.html" %}
{% load static %}
{% block title %}
Confirmaci√≥n de la subida del excel de localizaciones
{% endblock %}
{% load static %}
{% block content %} 
<!-- P√°gina de confirmaci√≥n para la subida de un excel para a√±adir localizaciones -->
 <link rel="stylesheet" href="{% static 'forms.css' %}">
<div class="form-container">

    <!-- CABECERA -->
    <div class="form-header">
        <h1>{% if errores_encontrados %}‚ùå Problemas con la subida del Excel de localizaciones:{% else %}‚úÖ Confirmaci√≥n de subida de Excel de localizaciones{% endif %} {% if errores_encontrados %} ERRORES DETECTADOS{% endif %}</h1>
        <p class="form-subtitle">
            
        </p>
    </div>

    <!-- MENSAJES DEL SISTEMA -->
    {% if messages %}
    <div class="form-card messages-card">
        <h2>üì¢ Mensajes</h2>
        {% for message in messages %}
            <p class="message-item">{{ message }}</p>
        {% endfor %}
    </div>
    {% endif %}

    <!-- INFORMACI√ìN DE ERRORES -->
    {% if errores_encontrados %}
    <div class="form-card info-card">
        <h2>‚ÑπÔ∏è Resultado de la validaci√≥n del Excel</h2>

        <p>
            Se ha generado un archivo Excel donde se indican las filas del
            archivo original que contienen errores:
        </p>

        <ul class="requirements-list">
            <li>
                <strong style="color:#d32f2f;">Filas en rojo</strong>:
                Errores que son necesario corregir para poder importar correctamente el fichero.
            </li>
        </ul>
    </div>

    <!-- DESCARGA DE EXCEL DE ERRORES Y SUBIDA DE ARCHIVO NUEVO -->
    <div class="form-card">
        <h2>üìÑ Excel con errores</h2>

        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                <button name="excel_errores"
                        type="submit"
                        class="accion-btn accion-secundaria">
                    ‚¨áÔ∏è Descargar Excel con errores
                </button>
            </div>

            <p style="margin-bottom: 15px;">
                Una vez corregidos los errores, vuelva a subir el archivo Excel.
            </p>
            <p class="note warning">
            ‚ö†Ô∏è No utilice el Excel de errores generado para subir nuevas localizaciones.
            </p>
                <h2>üì§ Subir otro archivo Excel</h2>
            <div class="form-field">
                <label for="excel_file_reupload">Excel file *</label>
                <input type="file" 
                       id="excel_file_reupload" 
                       name="excel_file" 
                       accept=".xlsx,.xlsm"
                       onchange="toggleSubmitButton()">
                <small class="error-text" style="display: block; color: #dc3545; margin-top: 5px;">Este campo es obligatorio.</small>
            </div>

            <div style="display: flex; justify-content: flex-end; margin-top: 10px;">
                <button type="submit" 
                        id="submitExcelBtn"
                        name="excel_file"
                        class="accion-btn accion-primaria"
                        disabled>
                    ‚¨ÜÔ∏è Subir Excel
                </button>
            </div>
        </form>
    </div>

    <script>
        function toggleSubmitButton() {
            const fileInput = document.getElementById('excel_file_reupload');
            const submitBtn = document.getElementById('submitExcelBtn');
            submitBtn.disabled = !fileInput.value;
        }
    </script>
    {% endif %}

    <!-- CONFIRMACI√ìN -->
    {% if not errores_encontrados %}
    <div class="form-card confirm-card">
        <h2>‚ùì Confirmaci√≥n</h2>
        <p>¬øDesea a√±adir las filas v√°lidas del archivo Excel?</p>

        <form method="post" class="form-actions">
            {% csrf_token %}

            <button type="submit"
                    name="confirmar"
                    class="accion-btn accion-primaria">
                üìç Confirmar creaci√≥n de localizaciones
            </button>

            <button type="submit"
                    name="cancelar"
                    class="accion-btn accion-peligro">
                ‚ùå Cancelar
            </button>
        </form>
    </div>
    {% endif %}

    <!-- VOLVER -->
    <div class="form-actions">
        <a href="/archivo" class="accion-btn accion-secundaria">
            ‚Ü© Volver a la vista de congeladores
        </a>
    </div>

</div>

{% endblock %}