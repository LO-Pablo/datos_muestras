{% extends "master.html" %}
{% load static %}
{% block title %}
Archivo de muestras
{% endblock %}

{% block content %} 
<!-- PÃ¡gina que muestra todas las localizaciones de las muestras en el archivo -->

<link rel="stylesheet" href="{% static 'localizaciones_todas.css' %}">
<script src="{% static 'mostrar.js' %}"></script>
<form action = "{% url 'eliminar_localizacion'%}" method="post">
  {%csrf_token%}
  <div class="acciones-archivo">

    <button type="button"
        onclick="location.href='/'"
        class="accion-btn accion-secundaria">
    â¬… Volver al inicio
    </button>

    <button type="button"
        onclick="location.href='/archivo/nuevo'"
        class="accion-btn accion-primaria">
    âž• AÃ±adir posiciones
    </button>

    <button type="submit" class="accion-btn accion-peligro" id="eliminar" name="eliminar"
        onclick="return confirm('Â¿Quieres eliminar las posiciones seleccionadas?')">
        ðŸ—‘ Eliminar posiciones
    </button>

</div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
{% if messages %}
 {% for message in messages %}
  <script>
      Swal.fire({
        title: '{{ message.tags|capfirst }}',
        text: '{{ message }}',
        icon: '{{ message.tags }}', // 'success', 'error', 'info', 'warning'
        confirmButtonText: 'Aceptar'
      });
</script>
{%endfor%}
{% endif %}
<!-- NavegaciÃ³n jerÃ¡rquica y desplegable de congeladores, estantes, racks, cajas y muestras -->
<nav id="archivo">
  <ul class="congeladores">
    {% for congelador in congeladores %}
    <li> <a href = "{% url 'detalles_congelador' congelador.congelador %}" class="chip-detalle">Detalles</a> <input type="checkbox" name="congelador" value = "{{congelador.id}}" class="form-control"><button type ="button" onclick = "desplegar(this,'estantes')" class="dropbtn">Congelador {{congelador.congelador}}</button>  
      <ul class="estantes">
      {% for estante in congelador.estantes.all %}
        <li><input type="checkbox" name="estante" value = "{{estante.id}}" class="form-control"><button type ="button" onclick = "desplegar(this,'racks')" class="dropbtn">Estante {{ estante.numero }}</button>
          {% for rack in estante.racks.all %}
            <ul class="racks">
              <li> <input type="checkbox" name="rack" value = "{{rack.id}}" class="form-control"><button type ="button" onclick = "desplegar(this,'cajas')" class="dropbtn">Rack {{ rack.numero }} - PosiciÃ³n dentro del estante: {{rack.posicion_rack_estante}}</button>
                <ul class ="cajas">
                  {% for caja in rack.cajas.all %}
                    <li> <input type="checkbox" name="caja" value = "{{caja.id}}" class="form-control"><button type ="button" onclick = "desplegar(this,'muestras')" class="dropbtn">Caja {{ caja.numero }} - PosiciÃ³n dentro del rack: {{caja.posicion_caja_rack}}<span class="chip">{{ caja.numero_muestras }} muestras</span></button>
                      <ul class="muestras">
                        {% for subposicion in caja.subposiciones.all %}
                                  {% if subposicion.vacia == False %}
                                  <li><span class="
                                            estado-icono
                                            {% if subposicion.muestras.estado_actual == 'Disponible' %}icono-disponible
                                            {% elif subposicion.muestras.estado_actual == 'Parcialmente enviada' %}icono-parcial
                                            {% endif %}
                                        "><svg class="icono-estado {{ clase_estado }}" width="14" height="14" viewBox="0 0 24 24">
                                          <path fill="currentColor" d="M7 2v2h1v3.586l-3.707 3.707A1 1 0 0 0 4 12v8a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3v-8a1 1 0 0 0-.293-.707L16 7.586V4h1V2H7Zm3 2h4v3.414l2 2V12H8V9.414l2-2V4Zm-2 10h8v6a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-6Z"/>
                                        </svg>
                                        </span><input type="checkbox" name= "subposicion" value = "{{subposicion.id}}"  class="form-control"> SubposiciÃ³n {{ subposicion.numero }}: <a href="detalles_muestra/{{subposicion.muestra.nom_lab}}">{{subposicion.muestra.nom_lab}}</a> 
                                    </li>
                                  {% else %}
                                  <li> <input type="checkbox" name= "subposicion" value = "{{subposicion.id}}"  class="form-control">SubposiciÃ³n {{ subposicion.numero }}: Vacia</li>
                                  {% endif %}
                                  {% endfor %}
                                </ul>
                              </li>
                              {% endfor %} 
                            </ul>
                           </li>
                        </ul>
                        {% endfor %} 
                     </li>
                  {%endfor%}
            </ul>
         </li> 
       {% endfor %} 
      </ul>
</nav>
</form>
{% endblock %}