{% extends "master.html" %}

{% block title %}
Lista de estudios del investigador
{% endblock %}
{% load static %}
{% block content %}
<!-- PÃ¡gina que muestra todos los estudios registrados en la base de datos -->
<link rel ="stylesheet" href="{% static 'estudios_todos.css' %}">
<div class="acciones-estudios">
    <a href="/" class="accion-btn accion-secundaria">
        â¬… Volver al inicio
    </a>
{% if perms.muestras.can_add_estudios_web %}
    <a href="/estudios/nuevo" class="accion-btn accion-primaria">
        â• Nuevo estudio
    </a>
    <a href="/estudios/excel" class="accion-btn accion-primaria">
        ğŸ“¤ğŸ“„ Subir Excel de estudios
    </a>
{% endif %}
</div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
{% if messages %}
 {% for message in messages %}
    <script>
      Swal.fire({
        title: '{{ message.tags|capfirst }}',
        text: '{{ message }}',
        icon: '{{ message.tags }}', // 'success', 'error', 'info', 'warning'
        confirmButtonText: 'Aceptar'
      });
    </script>
{% endfor %}
{% endif %}
<div class="table-container">
    <table class="styled-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Referencia</th>
                <th>Nombre</th>
                <th class="wrap-text">DescripciÃ³n</th>
                <th>Inicio</th>
                <th>Fin</th>
                <th>Investigador principal</th>
                <th>Acciones</th>
            </tr>
        </thead>

        <tbody>
        {% for estudio in estudios %}
            <tr>
                <td>{{ estudio.id }}</td>
                <td>{{ estudio.referencia_estudio|default:"â€”" }}</td>

                <td>{{ estudio.nombre_estudio }}</td>

                <td class="wrap-text">
                    {{ estudio.descripcion_estudio|default:"â€”" }}
                </td>

                <td>{{ estudio.fecha_inicio_estudio|default:"â€”" }}</td>

                <td>{{ estudio.fecha_fin_estudio|default:"â€”" }}</td>

                <td>{{ estudio.investigador_principal|default:"â€”" }}</td>

                <td>
                    <a href="/estudios/{{estudio.id}}" class="chip-detalle">
                        ğŸ“„ DocumentaciÃ³n
                    </a>
                    {% if perms.muestras.can_change_estudios_web %}
                    <a href="/estudios/{{estudio.id}}/editar" class="chip-detalle">
                        âœ Editar
                    </a>
                    {% endif %}
                    {% if perms.muestras.can_delete_estudios_web %}
                    {% if estudio.num_muestras > 0 %}
                    <a href="#" onclick="Swal.fire({title: 'No se puede eliminar', text: 'El estudio tiene muestras asociadas. Desasocia las muestras primero.', icon: 'warning', confirmButtonText: 'Aceptar'}); return false;" class="chip-detalle">
                        ğŸ—‘ï¸ Eliminar
                    </a>
                    {% else %}
                    <a href="/estudios/{{estudio.id}}/eliminar" class="chip-detalle" onclick="return confirm('Â¿Quieres eliminar este estudio?')">
                        ğŸ—‘ï¸ Eliminar
                    </a>
                    {% endif %}
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

{%endblock%}